---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

function formatDate(date: Date) {
	return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
}

function readingTime(body: string | undefined) {
	if (!body) return '1 min read';
	const words = body.trim().split(/\s+/).length;
	return `${Math.max(1, Math.ceil(words / 200))} min read`;
}
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<section class="profile">
				<img
					src="https://github.com/JulienLach.png"
					alt="Julien Lach"
					class="avatar"
				/>
				<div class="bio">
					<strong>Julien Lach</strong>
					<span class="handle">@JulienLach</span>
					<span class="title">Software Developer</span>
					<span class="stack">Building web applications for business — organization, workflow, and digital transformation.</span>
					<span class="stack">France</span>
					<div class="social">
						<a href="https://github.com/JulienLach" target="_blank" rel="noopener" aria-label="GitHub">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
								<path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/>
							</svg>
						</a>
						<a href="https://x.com/Julien_Lach" target="_blank" rel="noopener" aria-label="X">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
								<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.744l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
							</svg>
						</a>
						<a href="https://linkedin.com/in/julienlach" target="_blank" rel="noopener" aria-label="LinkedIn">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
								<path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/>
							</svg>
						</a>
					</div>
				</div>
			</section>

			<section class="posts">
				{posts.map((post) => (
					<article>
						<a href={`/blog/${post.id}/`}>
							<h2>{post.data.title}</h2>
						</a>
						<p class="meta">
							Published: {formatDate(post.data.pubDate)}
							{post.body && <span> · {readingTime(post.body)}</span>}
						</p>
						{post.data.description && (
							<p class="description">{post.data.description}</p>
						)}
					</article>
				))}
			</section>
		</main>
		<Footer />
	</body>
</html>

<style>
	.profile {
		display: flex;
		gap: 1.2rem;
		align-items: flex-start;
		padding: 2rem 0;
		border-bottom: 1px solid var(--border);
		margin-bottom: 2rem;
	}
	.avatar {
		width: 190px;
		height: 190px;
		border-radius: 50%;
		flex-shrink: 0;
	}
	.bio {
		display: flex;
		flex-direction: column;
		gap: 0.2rem;
	}
	.bio strong {
		color: var(--fg);
	}
	.handle, .title, .stack {
		color: var(--dim);
		font-size: 0.95em;
	}
	.social {
		display: flex;
		gap: 0.8rem;
		margin-top: 0.4rem;
	}
	.social a {
		color: var(--dim);
		text-decoration: none;
		display: flex;
		align-items: center;
		transition: color 0.15s, transform 0.15s;
	}
	.social a:hover {
		color: var(--fg);
		transform: translateY(-2px);
	}

	.posts {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}
	article h2 {
		font-size: 1em;
		margin-bottom: 0.2rem;
		color: var(--accent);
	}
	article a {
		text-decoration: none;
	}
	article a:hover h2 {
		opacity: 0.75;
	}
	.meta {
		color: var(--dim);
		font-size: 0.85em;
		margin: 0 0 0.4rem;
	}
	.description {
		color: var(--dim);
		margin: 0;
		font-size: 0.95em;
	}
</style>
